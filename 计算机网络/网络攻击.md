# 网络攻击

### 一、XSS攻击

#### 1.定义

Cross-Site Scripting（跨站脚本攻击）简称 XSS，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如 Cookie、SessionID 等，进而危害数据安全。

恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。而由于直接在用户的终端执行，恶意代码能够直接获取用户的信息，或者利用这些信息冒充用户向网站发起攻击者定义的请求。在部分情况下，由于输入的限制，注入的恶意脚本比较短。但可以通过引入外部的脚本，并由浏览器执行，来完成比较复杂的攻击策略。

#### 2.分类

##### （1）存储型

存储型XSS的攻击脚本常常是由前端提交的数据未经过处理直接存储到数据库，然后从数据库中读取出来后又直接插入到页面中所导致的。

###### 攻击步骤：

- 攻击者将恶意代码提交到目标网站的数据库中。
- 用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。
- 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
- 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

###### 攻击例子：

```html
<!-- 是我们要渲染的内容模板 -->
<div>{{ content }}</div>

<!-- 从后台从数据库中读取数据返回并在前端页面模板中直接渲染导致存储型XSs，下面是渲染后输出的内容 -->
<div><script>alert();</script></div>
```

###### 常见攻击：

常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。

##### （2）反射型

反射性XSS可能是在网页URL参数中注入了可解析内容的数据而导致的，如果直接获取URL中不合法的数据并插入页面中则可能出现出现页面上的XSS攻击。

###### 攻击步骤：

- 攻击者构造出特殊的 URL，其中包含恶意代码。
- 用户打开含有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。
- 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
- 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

###### 攻击例子：

```html
<!-- 反射型xss，例如Node服务器端渲染数据，Web服务器脚本从前端URL中获取数据后直接渲染到前端页面导致 -->
let name = reg.query['name'];
this.body = '<div>$ {name}</div>';
<!-- url里传递的name参数值如果为'<script>alert();</script>', 则输出为<div><script>alert(); 会导致页面上的XSS -->
<!-- 例如http://localhost:3000/?xss=<script>alert('你被xss攻击了')</script> -->
```

###### 常见攻击：

常见于通过 URL 传递参数的功能，如网站搜索、跳转等。

> 反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。

##### （3）DOM型（MXSS）

MXSS则是在渲染DOM属性时将攻击脚本插入DOM属性中被解析而导致的。

###### 攻击步骤：

- 攻击者构造出特殊的 URL，其中包含恶意代码。
- 用户打开带有恶意代码的 URL。
- 用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。
- 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

###### 攻击例子：

```html
<!-- MXSs，页面标签元素属性在前端渲染时含有可解析的标签导致，下面是要渲染的内容 -->
<p calss="class-a {b1}"></p>
<!-- 插入悲意脚本内容的输出结果 -->
<p calss-"class-a "><script>alert()</script><p class="class-b"></p>
```

> DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。

#### 3.如何阻止XSS攻击

##### （1）由服务器对输入脚本进行过滤或者转码

对一些明确的输入类型，例如数字、URL、电话号码、邮件地址等等内容，进行输入过滤。

例如：

```
1235<script>alert('你被 xss 攻击了')</script>
```

这段代码过滤后，只留下了：1235；这样，当用户再次请求该页面时，由于`<script>`标签的内容都被过滤了，所以这段脚本在客户端是不可能被执行的。

除了过滤外，服务器还可以对这些内容进行转码，还是上面那段代码，经过转码之后，效果如下所示：

```js
1235:&lt;script&gt;alert(&#39; 你被 xss 攻击了 &#39;)&lt;/script&gt;
```

但是对于其他不太明确的内容尽量不要使用这种方法。例如：一个正常的用户输入了 `5 < 7` 这个内容，在写入数据库前，被转义成了 `5 &lt 7`。现在问题是：如果前端从数据库读出这个内容，不知道要不要对符号进行还原，就有可能变成了乱码（5 &lt 7）,会引入很大的不确定性和乱码问题。

> 为什么不在前端对输入脚本进行过滤？
>
> 因为一旦攻击者绕过前端过滤，直接构造请求，就可以提交恶意代码了。

##### （2）充分利用CSP（网页安全策略）

虽然在服务器端执行过滤或者转码可以阻止 XSS 攻击的发生，但完全依靠服务器端依然是不够的，我们还需要把 CSP 等策略充分地利用起来，以降低 XSS 攻击带来的风险和后果。

###### CSP定义

CSP 的实质就是白名单制度，开发者明确告诉客户端，哪些外部资源可以加载和执行，等同于提供白名单。它的实现和执行全部由浏览器完成，开发者只需提供配置。

它是一种由开发者定义的安全策略性声明，通过CSP所约束的规则设定，浏览器只可以加载指定可信的域名来源的内容（这里的内容可以是脚本、图片、iframe、font、style等远程资源）。通过CSP协定，Web只能加载指定安全域名下的资源文件，保证运行时的内容总处于一个安全的环境中。

###### 如何启用CSP

- 第一种可通过 HTTP 头信息的`Content-Security-Policy`的字段

  ```http
  Content-Security-Policy: script-src 'self'; object-src 'none';
  style-src cdn.example.org third-party.org; child-src https:
  ```

- 另一种是通过网页的`<meta>`标签。

  ```markup
  <meta http-equiv="Content-Security-Policy" content="script-src 'self'; object-src 'none'; style-src cdn.example.org third-party.org; child-src https:">
  ```

上面代码中，CSP 做了如下配置：

- 脚本：只信任当前域名
- `<object>`标签：不信任任何URL，即不加载任何资源
- 样式表：只信任`cdn.example.org`和`third-party.org`
- 框架（frame）：必须使用HTTPS协议加载
- 其他资源：没有限制

启用后，不符合 CSP 的外部资源就会被阻止加载。

###### CSP功能

- 限制加载其他域下的资源文件，这样即使黑客插入了一个 JavaScript 文件，这个 JavaScript 文件也是无法被加载的；
- 禁止向第三方域提交数据，这样用户数据也不会外泄；
- 禁止执行内联脚本和未授权的脚本；
- 还提供了上报机制，这样可以帮助我们尽快发现有哪些 XSS 攻击，以便尽快修复问题。

> 具体CSP介绍可参考文章：http://www.ruanyifeng.com/blog/2016/09/csp.html

##### （3）使用HttpOnly属性

由于很多 XSS 攻击都是来盗用 Cookie 的，因此还可以通过使用 HttpOnly 属性来保护我们 Cookie 的安全。

通常服务器可以将某些 Cookie 设置为 HttpOnly 标志，使用 HttpOnly 标记的 Cookie 只能使用在 HTTP 请求过程中，所以无法通过 JavaScript 来读取这段 Cookie。

### 二、CSRF攻击

### 7.HTTPS

### 8.常见面试题

##### 8.1http和https的区别

（1.介绍http/https的概念->2.讲述两者区别->3.讲述https的工作原理->https的优缺点）

- http传输的数据都是未加密的，也就是明文的。https协议设置了SSL协议来对http协议传输的数据进行加密处理，简单来说https协议是由http和ssl协议构建的可进行加密传输和身份认证的网络协议，比http协议的安全性更高。
- 使用不同的链接方式，端口也不同.一般而言。http协议的端口为80，https的端口为443。
- https协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。

##### 8.2https的优缺点

优点：

- 有利于SEO

  比起同等HTTP网站，采用HTTPS加密的网站在搜索结果中的排名将会更高

- 更安全，是现有架构中最安全的解决方案

  使用HTTPS协议可认证用户和服务器，确保数据发送到正确的客户机和服务器；

  HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，要比http协议安全，可防止数据在传输过程中不被窃取、改变，确保数据的完整性。

  HTTPS是现行架构下最安全的解决方案，虽然不是绝对安全，但它大幅增加了中间人攻击的成本。

缺点：

- 使用HTTPS协议会使页面的加载时间延长近50%，增加10%到20%的耗电（因为SSL/TLS协议许需要一个握手过程）。
- HTTPS协议的加密范围也比较有限，在黑客攻击、拒绝服务攻击、服务器劫持等方面几乎起不到什么作用。
- SSL证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行。
- SSL证书需要钱，功能越强大的证书费用越高，个人网站、小网站没有必要一般不会用。
- SSL证书通常需要绑定IP，不能在同一IP上绑定多个域名，IPv4资源不可能支撑这个消耗。
- HTTPS连接缓存不如HTTP高效，大流量网站如非必要也不会采用，流量成本太高。







参考文章：https://tech.meituan.com/2018/09/27/fe-security.html